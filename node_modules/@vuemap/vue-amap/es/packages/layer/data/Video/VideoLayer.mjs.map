{"version":3,"file":"VideoLayer.mjs","sources":["../../../../../packages/layer/data/Video/VideoLayer.ts"],"sourcesContent":["interface VideoOption {\r\n  url: string\r\n  zooms: number[]\r\n  bounds: any\r\n  opacity: number\r\n  loop: boolean\r\n}\r\n\r\nclass VideoLayer {\r\n\r\n  canvas: HTMLCanvasElement | null;\r\n  context: CanvasRenderingContext2D | null;\r\n  video: HTMLVideoElement | null;\r\n  layer: any;\r\n  canPlay = false;\r\n  frame = -1;\r\n\r\n  constructor(options: VideoOption, video: HTMLVideoElement) {\r\n    const canvas = document.createElement('canvas');\r\n    this.video = video;\r\n    video.src = options.url;\r\n    video.autoplay = true;\r\n    video.loop = options.loop;\r\n    const layerOptions = {\r\n      ...options,\r\n      canvas\r\n    }\r\n    this.canvas = canvas;\r\n    this.context = canvas.getContext('2d') as CanvasRenderingContext2D;\r\n    this.layer = new AMap.CanvasLayer(layerOptions);\r\n    this.initVideoEvents();\r\n    this.load();\r\n  }\r\n\r\n  getLayer() {\r\n    return this.layer;\r\n  }\r\n\r\n  initVideoEvents() {\r\n    this.video?.addEventListener('canplaythrough', () => {\r\n      if (this.canvas) {\r\n        this.canvas.width = this.video?.videoWidth as number;\r\n        this.canvas.height = this.video?.videoHeight as number;\r\n      }\r\n      this.canPlay = true;\r\n      this.play();\r\n    })\r\n  }\r\n\r\n  load() {\r\n    this.video?.load()\r\n  }\r\n\r\n  play() {\r\n    if (this.canPlay) {\r\n      this.video?.play();\r\n      this.stopRender()\r\n      this.render()\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    this.stopRender();\r\n    this.video?.pause();\r\n  }\r\n\r\n  stopRender() {\r\n    if (this.frame) {\r\n      cancelAnimationFrame(this.frame);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    this.frame = window.requestAnimationFrame(() => {\r\n      this.render()\r\n    })\r\n    if (this.video?.paused) {\r\n      this.video?.play();\r\n    } else {\r\n      this.context?.clearRect(0, 0, this.canvas?.width as number, this.canvas?.height as number)\r\n      this.context?.drawImage(this.video as any, 0, 0, this.canvas?.width as number, this.canvas?.height as number)  //绘制视频\r\n      this.layer.reFresh();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.stopRender();\r\n    if (this.video) {\r\n      this.video.pause();\r\n    }\r\n    this.video = null;\r\n  }\r\n\r\n  setUrl(url: string) {\r\n    this.stopRender();\r\n    this.canPlay = false;\r\n    if (this.video) {\r\n      this.video.src = url;\r\n      this.load()\r\n    }\r\n  }\r\n\r\n  setZooms(zooms) {\r\n    this.getLayer().setZoom(zooms);\r\n  }\r\n\r\n  setOpacity(opacity) {\r\n    this.getLayer().setOpacity(opacity);\r\n  }\r\n\r\n  setBounds(bounds) {\r\n    this.getLayer().setBounds(bounds);\r\n  }\r\n\r\n  setzIndex(zIndex) {\r\n    this.getLayer().setzIndex(zIndex);\r\n  }\r\n\r\n  show() {\r\n    this.getLayer().show();\r\n  }\r\n\r\n  hide() {\r\n    this.getLayer().hide();\r\n  }\r\n}\r\n\r\nexport default VideoLayer\r\n"],"names":[],"mappings":"AAQA,MAAiB,UAAA,CAAA;AAAA,EASf,WAAA,CAAY,SAAsB,KAAyB,EAAA;AAH3D,IAAU,IAAA,CAAA,OAAA,GAAA,KAAA,CAAA;AACV,IAAQ,IAAA,CAAA,KAAA,GAAA,CAAA,CAAA,CAAA;AAGN,IAAM,MAAA,MAAA,GAAS,SAAS,aAAc,CAAA,QAAA,CAAA,CAAA;AACtC,IAAA,IAAA,CAAK,KAAQ,GAAA,KAAA,CAAA;AACb,IAAA,KAAA,CAAM,MAAM,OAAQ,CAAA,GAAA,CAAA;AACpB,IAAA,KAAA,CAAM,QAAW,GAAA,IAAA,CAAA;AACjB,IAAA,KAAA,CAAM,OAAO,OAAQ,CAAA,IAAA,CAAA;AACrB,IAAA,MAAM,YAAe,GAAA;AAAA,MAChB,GAAA,OAAA;AAAA,MACH,MAAA;AAAA,KAAA,CAAA;AAEF,IAAA,IAAA,CAAK,MAAS,GAAA,MAAA,CAAA;AACd,IAAK,IAAA,CAAA,OAAA,GAAU,OAAO,UAAW,CAAA,IAAA,CAAA,CAAA;AACjC,IAAK,IAAA,CAAA,KAAA,GAAQ,IAAI,IAAA,CAAK,WAAY,CAAA,YAAA,CAAA,CAAA;AAClC,IAAK,IAAA,CAAA,eAAA,EAAA,CAAA;AACL,IAAK,IAAA,CAAA,IAAA,EAAA,CAAA;AAAA,GAAA;AAAA,EAGP,QAAW,GAAA;AACT,IAAA,OAAO,IAAK,CAAA,KAAA,CAAA;AAAA,GAAA;AAAA,EAGd,eAAkB,GAAA;AAtCpB,IAAA,IAAA,EAAA,CAAA;AAuCI,IAAA,CAAA,EAAA,GAAA,IAAA,CAAK,KAAL,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAY,gBAAiB,CAAA,gBAAA,EAAkB,MAAM;AAvCzD,MAAA,IAAA,GAAA,EAAA,EAAA,CAAA;AAwCM,MAAA,IAAI,KAAK,MAAQ,EAAA;AACf,QAAA,IAAA,CAAK,MAAO,CAAA,KAAA,GAAQ,CAAK,GAAA,GAAA,IAAA,CAAA,KAAA,KAAL,IAAY,GAAA,KAAA,CAAA,GAAA,GAAA,CAAA,UAAA,CAAA;AAChC,QAAA,IAAA,CAAK,MAAO,CAAA,MAAA,GAAS,CAAK,EAAA,GAAA,IAAA,CAAA,KAAA,KAAL,IAAY,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,WAAA,CAAA;AAAA,OAAA;AAEnC,MAAA,IAAA,CAAK,OAAU,GAAA,IAAA,CAAA;AACf,MAAK,IAAA,CAAA,IAAA,EAAA,CAAA;AAAA,KAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAIT,IAAO,GAAA;AAjDT,IAAA,IAAA,EAAA,CAAA;AAkDI,IAAA,CAAA,EAAA,GAAA,IAAA,CAAK,UAAL,IAAY,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,EAAA,CAAA;AAAA,GAAA;AAAA,EAGd,IAAO,GAAA;AArDT,IAAA,IAAA,EAAA,CAAA;AAsDI,IAAA,IAAI,KAAK,OAAS,EAAA;AAChB,MAAA,CAAA,EAAA,GAAA,IAAA,CAAK,UAAL,IAAY,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,EAAA,CAAA;AACZ,MAAK,IAAA,CAAA,UAAA,EAAA,CAAA;AACL,MAAK,IAAA,CAAA,MAAA,EAAA,CAAA;AAAA,KAAA;AAAA,GAAA;AAAA,EAIT,KAAQ,GAAA;AA7DV,IAAA,IAAA,EAAA,CAAA;AA8DI,IAAK,IAAA,CAAA,UAAA,EAAA,CAAA;AACL,IAAA,CAAA,EAAA,GAAA,IAAA,CAAK,UAAL,IAAY,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,KAAA,EAAA,CAAA;AAAA,GAAA;AAAA,EAGd,UAAa,GAAA;AACX,IAAA,IAAI,KAAK,KAAO,EAAA;AACd,MAAA,oBAAA,CAAqB,IAAK,CAAA,KAAA,CAAA,CAAA;AAAA,KAAA;AAAA,GAAA;AAAA,EAI9B,MAAS,GAAA;AAxEX,IAAA,IAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,CAAA;AAyEI,IAAK,IAAA,CAAA,KAAA,GAAQ,MAAO,CAAA,qBAAA,CAAsB,MAAM;AAC9C,MAAK,IAAA,CAAA,MAAA,EAAA,CAAA;AAAA,KAAA,CAAA,CAAA;AAEP,IAAI,IAAA,CAAA,EAAA,GAAA,IAAA,CAAK,KAAL,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAY,MAAQ,EAAA;AACtB,MAAA,CAAA,EAAA,GAAA,IAAA,CAAK,UAAL,IAAY,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,IAAA,EAAA,CAAA;AAAA,KACP,MAAA;AACL,MAAK,CAAA,EAAA,GAAA,IAAA,CAAA,OAAA,KAAL,IAAc,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,SAAA,CAAU,CAAG,EAAA,CAAA,EAAG,CAAK,EAAA,GAAA,IAAA,CAAA,MAAA,KAAL,IAAa,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,KAAA,EAAiB,CAAK,EAAA,GAAA,IAAA,CAAA,MAAA,KAAL,IAAa,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,MAAA,CAAA,CAAA;AACzE,MAAA,CAAA,EAAA,GAAA,IAAA,CAAK,OAAL,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAc,SAAU,CAAA,IAAA,CAAK,KAAc,EAAA,CAAA,EAAG,CAAG,EAAA,CAAA,EAAA,GAAA,IAAA,CAAK,MAAL,KAAA,IAAA,GAAA,KAAA,CAAA,GAAA,EAAA,CAAa,KAAiB,EAAA,CAAA,EAAA,GAAA,IAAA,CAAK,WAAL,IAAa,GAAA,KAAA,CAAA,GAAA,EAAA,CAAA,MAAA,CAAA,CAAA;AAC5F,MAAA,IAAA,CAAK,KAAM,CAAA,OAAA,EAAA,CAAA;AAAA,KAAA;AAAA,GAAA;AAAA,EAIf,OAAU,GAAA;AACR,IAAK,IAAA,CAAA,UAAA,EAAA,CAAA;AACL,IAAA,IAAI,KAAK,KAAO,EAAA;AACd,MAAA,IAAA,CAAK,KAAM,CAAA,KAAA,EAAA,CAAA;AAAA,KAAA;AAEb,IAAA,IAAA,CAAK,KAAQ,GAAA,IAAA,CAAA;AAAA,GAAA;AAAA,EAGf,OAAO,GAAa,EAAA;AAClB,IAAK,IAAA,CAAA,UAAA,EAAA,CAAA;AACL,IAAA,IAAA,CAAK,OAAU,GAAA,KAAA,CAAA;AACf,IAAA,IAAI,KAAK,KAAO,EAAA;AACd,MAAA,IAAA,CAAK,MAAM,GAAM,GAAA,GAAA,CAAA;AACjB,MAAK,IAAA,CAAA,IAAA,EAAA,CAAA;AAAA,KAAA;AAAA,GAAA;AAAA,EAIT,SAAS,KAAO,EAAA;AACd,IAAA,IAAA,CAAK,WAAW,OAAQ,CAAA,KAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAG1B,WAAW,OAAS,EAAA;AAClB,IAAA,IAAA,CAAK,WAAW,UAAW,CAAA,OAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAG7B,UAAU,MAAQ,EAAA;AAChB,IAAA,IAAA,CAAK,WAAW,SAAU,CAAA,MAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAG5B,UAAU,MAAQ,EAAA;AAChB,IAAA,IAAA,CAAK,WAAW,SAAU,CAAA,MAAA,CAAA,CAAA;AAAA,GAAA;AAAA,EAG5B,IAAO,GAAA;AACL,IAAA,IAAA,CAAK,QAAW,EAAA,CAAA,IAAA,EAAA,CAAA;AAAA,GAAA;AAAA,EAGlB,IAAO,GAAA;AACL,IAAA,IAAA,CAAK,QAAW,EAAA,CAAA,IAAA,EAAA,CAAA;AAAA,GAAA;AAAA;;;;"}