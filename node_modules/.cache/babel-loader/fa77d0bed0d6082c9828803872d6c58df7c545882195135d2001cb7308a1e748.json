{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  slot: \"tip\",\n  class: \"el-upload__tip\",\n  style: {\n    \"color\": \"#838fa1\"\n  }\n};\nconst _hoisted_2 = [\"src\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon_plus = _resolveComponent(\"el-icon-plus\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_dialog = _resolveComponent(\"el-dialog\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createCommentVNode(\" 上传文件组件 \"), _createVNode(_component_el_upload, {\n    ref: \"upload\",\n    action: $options.getActionUrl,\n    \"list-type\": \"picture-card\",\n    multiple: $props.multiple,\n    limit: $props.limit,\n    headers: $data.myHeaders,\n    \"file-list\": $data.fileList,\n    \"on-exceed\": $options.handleExceed,\n    \"on-preview\": $options.handleUploadPreview,\n    \"on-remove\": $options.handleRemove,\n    \"on-success\": $options.handleUploadSuccess,\n    \"on-error\": $options.handleUploadErr,\n    \"before-upload\": $options.handleBeforeUpload\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_icon, null, {\n      default: _withCtx(() => [_createVNode(_component_el_icon_plus)]),\n      _: 1 /* STABLE */\n    }), _createElementVNode(\"div\", _hoisted_1, _toDisplayString($props.tip), 1 /* TEXT */)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"action\", \"multiple\", \"limit\", \"headers\", \"file-list\", \"on-exceed\", \"on-preview\", \"on-remove\", \"on-success\", \"on-error\", \"before-upload\"]), _createVNode(_component_el_dialog, {\n    visible: $data.dialogVisible,\n    size: \"tiny\",\n    \"append-to-body\": \"\"\n  }, {\n    default: _withCtx(() => [_createElementVNode(\"img\", {\n      width: \"100%\",\n      src: $data.dialogImageUrl,\n      alt: \"\"\n    }, null, 8 /* PROPS */, _hoisted_2)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"visible\"])]);\n}","map":{"version":3,"names":["slot","class","style","_createElementBlock","_createCommentVNode","_createVNode","_component_el_upload","ref","action","$options","getActionUrl","multiple","$props","limit","headers","$data","myHeaders","fileList","handleExceed","handleUploadPreview","handleRemove","handleUploadSuccess","handleUploadErr","handleBeforeUpload","_component_el_icon","_component_el_icon_plus","_createElementVNode","_hoisted_1","_toDisplayString","tip","_component_el_dialog","visible","dialogVisible","size","width","src","dialogImageUrl","alt"],"sources":["D:\\bise\\bise\\front\\src\\components\\common\\FileUpload.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- 上传文件组件 -->\n    <el-upload\n      ref=\"upload\"\n      :action=\"getActionUrl\"\n      list-type=\"picture-card\"\n      :multiple=\"multiple\"\n      :limit=\"limit\"\n      :headers=\"myHeaders\"\n      :file-list=\"fileList\"\n      :on-exceed=\"handleExceed\"\n      :on-preview=\"handleUploadPreview\"\n      :on-remove=\"handleRemove\"\n      :on-success=\"handleUploadSuccess\"\n      :on-error=\"handleUploadErr\"\n      :before-upload=\"handleBeforeUpload\"\n    >\n      <el-icon><el-icon-plus /></el-icon>\n      <div slot=\"tip\" class=\"el-upload__tip\" style=\"color: #838fa1\">\n        {{ tip }}\n      </div>\n    </el-upload>\n    <el-dialog :visible.sync=\"dialogVisible\" size=\"tiny\" append-to-body>\n      <img width=\"100%\" :src=\"dialogImageUrl\" alt />\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { Plus as ElIconPlus } from '@element-plus/icons-vue'\nimport storage from '@/utils/storage'\nimport base from '@/utils/base'\nexport default {\n  components: {\n    ElIconPlus,\n  },\n  data() {\n    return {\n      // 查看大图\n      dialogVisible: false,\n      // 查看大图\n      dialogImageUrl: '',\n      // 组件渲染图片的数组字段，有特殊格式要求\n      fileList: [],\n      fileUrlList: [],\n      myHeaders: {},\n    }\n  },\n  props: ['tip', 'action', 'limit', 'multiple', 'fileUrls'],\n  mounted() {\n    this.init()\n    this.myHeaders = {\n      Token: storage.get('Token'),\n    }\n  },\n  watch: {\n    fileUrls: function (val, oldVal) {\n      //   console.log(\"new: %s, old: %s\", val, oldVal);\n      this.init()\n    },\n  },\n  computed: {\n    // 计算属性的 getter\n    getActionUrl: function () {\n      // return base.url + this.action + \"?token=\" + storage.get(\"token\");\n      return `/${this.$base.name}/` + this.action\n    },\n  },\n  methods: {\n    // 初始化\n    init() {\n      //   console.log(this.fileUrls);\n      if (this.fileUrls) {\n        this.fileUrlList = this.fileUrls.split(',')\n        let fileArray = []\n        this.fileUrlList.forEach(function (item, index) {\n          var url = item\n          var name = index\n          var file = {\n            name: name,\n            url: url,\n          }\n          fileArray.push(file)\n        })\n        this.setFileList(fileArray)\n      }\n    },\n    handleBeforeUpload(file) {},\n    // 上传文件成功后执行\n    handleUploadSuccess(res, file, fileList) {\n      if (res && res.code === 0) {\n        fileList[fileList.length - 1]['url'] = '/upload/' + file.response.file\n        this.setFileList(fileList)\n        this.$emit('change', this.fileUrlList.join(','))\n      } else {\n        this.$message.error(res.msg)\n      }\n    },\n    // 图片上传失败\n    handleUploadErr(err, file, fileList) {\n      this.$message.error('文件上传失败')\n    },\n    // 移除图片\n    handleRemove(file, fileList) {\n      this.setFileList(fileList)\n      this.$emit('change', this.fileUrlList.join(','))\n    },\n    // 查看大图\n    handleUploadPreview(file) {\n      this.dialogImageUrl = file.url\n      this.dialogVisible = true\n    },\n    // 限制图片数量\n    handleExceed(files, fileList) {\n      this.$message.warning(`最多上传${this.limit}张图片`)\n    },\n    // 重新对fileList进行赋值\n    setFileList(fileList) {\n      var fileArray = []\n      var fileUrlArray = []\n      // 有些图片不是公开的，所以需要携带token信息做权限校验\n      var token = storage.get('token')\n      fileList.forEach(function (item, index) {\n        var url = item.url.split('?')[0]\n        var name = item.name\n        var file = {\n          name: name,\n          url: url + '?token=' + token,\n        }\n        fileArray.push(file)\n        fileUrlArray.push(url)\n      })\n      this.fileList = fileArray\n      this.fileUrlList = fileUrlArray\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped></style>\n"],"mappings":";;EAmBWA,IAAI,EAAC,KAAK;EAACC,KAAK,EAAC,gBAAgB;EAACC,KAAsB,EAAtB;IAAA;EAAA;;;;;;;;uBAlB3CC,mBAAA,CAyBM,cAxBJC,mBAAA,YAAe,EACfC,YAAA,CAmBYC,oBAAA;IAlBVC,GAAG,EAAC,QAAQ;IACXC,MAAM,EAAEC,QAAA,CAAAC,YAAY;IACrB,WAAS,EAAC,cAAc;IACvBC,QAAQ,EAAEC,MAAA,CAAAD,QAAQ;IAClBE,KAAK,EAAED,MAAA,CAAAC,KAAK;IACZC,OAAO,EAAEC,KAAA,CAAAC,SAAS;IAClB,WAAS,EAAED,KAAA,CAAAE,QAAQ;IACnB,WAAS,EAAER,QAAA,CAAAS,YAAY;IACvB,YAAU,EAAET,QAAA,CAAAU,mBAAmB;IAC/B,WAAS,EAAEV,QAAA,CAAAW,YAAY;IACvB,YAAU,EAAEX,QAAA,CAAAY,mBAAmB;IAC/B,UAAQ,EAAEZ,QAAA,CAAAa,eAAe;IACzB,eAAa,EAAEb,QAAA,CAAAc;;sBAEhB,MAAmC,CAAnClB,YAAA,CAAmCmB,kBAAA;wBAA1B,MAAgB,CAAhBnB,YAAA,CAAgBoB,uBAAA,E;;QACzBC,mBAAA,CAEM,OAFNC,UAEM,EAAAC,gBAAA,CADDhB,MAAA,CAAAiB,GAAG,iB;;iKAGVxB,YAAA,CAEYyB,oBAAA;IAFAC,OAAO,EAAOhB,KAAA,CAAAiB,aAAa;IAAEC,IAAI,EAAC,MAAM;IAAC,gBAAc,EAAd;;sBACnD,MAA8C,CAA9CP,mBAAA,CAA8C;MAAzCQ,KAAK,EAAC,MAAM;MAAEC,GAAG,EAAEpB,KAAA,CAAAqB,cAAc;MAAEC,GAAG,EAAH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}